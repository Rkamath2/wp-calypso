@startuml

'red: #facfd2
'orange: #f7dcc6
'yellow: #f5e6b3
'green: #b8e6bf

skinparam ParticipantPadding 5
skinparam BoxPadding 5

box "" #f7dcc6
  participant WordPress.com
end box
box "Calypso" #f5e6b3
  participant Undocumented
end box
box "Composite Checkout" #b8e6bf
  participant useInitializeCartFromServer
  participant useShoppingCartManager
  participant CompositeCheckout
  participant useShoppingCartReducer
end box

Undocumented -> CompositeCheckout : import getCart
note over CompositeCheckout
	getCart from props
	or fall back to import
end note
CompositeCheckout -> useShoppingCartManager : cartKey, getCart
note over useShoppingCartManager : getCart bound to cartKey
useShoppingCartManager -> useInitializeCartFromServer : getCart
useInitializeCartFromServer -> Undocumented : << getCart >>
activate Undocumented
Undocumented -> WordPress.com : GET /me/shopping-cart/{cartKey}
activate WordPress.com
return
return
useInitializeCartFromServer -> useShoppingCartReducer : dispatch RECEIVE_INITIAL_RESPONSE_CART
note over useInitializeCartFromServer : event CART_INIT_COMPLETE
note over useShoppingCartReducer
  Moves the payload to .responseCart
  updates .couponStatus,
  and sets .cacheStatus to 'valid'
end note
useShoppingCartReducer -> useShoppingCartManager : responseCart, couponStatus, cacheStatus
note over useShoppingCartManager
  cacheStatus =>
    isLoading
    loadingError
    isPendingUpdate
end note
useShoppingCartManager -> CompositeCheckout
note over CompositeCheckout: render
@enduml
